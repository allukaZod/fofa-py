<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>fofa.client API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>fofa.client</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">#!/usr/bin/python3
# -*- coding: utf-8 -*-
# Author: Erdog, Loveforkeeps, Alluka
import base64
import json
import logging
import requests
import os
import sys

from retry.api import retry_call

if __name__ == &#39;__main__&#39;:
    # 当作为脚本直接执行时的处理方式
    from exception import FofaError
    from helper import get_language, encode_query
else:
    # 当作为包/模块导入时的处理方式
    from .exception import FofaError
    from .helper import get_language, encode_query

class Client:
    &#34;&#34;&#34;
    A class representing the FOFA client.

    :param email: The Fofa Email. If not specified, it will be read from the FOFA_EMAIL environment variable.
    :type email: str
    :param key: The Fofa api key. If not specified, it will be read from the FOFA_KEY environment variable.
    :type key: str
    :param base_url: The base URL of the FOFA API. Defaults to &#39;https://fofa.info&#39;.
    :type base_url: str
    :param proxies:  A proxies array for the requests library, e.g. {&#39;https&#39;: &#39;your proxy&#39;}
    :type proxies: dict

    &#34;&#34;&#34;

    def __init__(self, email=&#39;&#39;, key=&#39;&#39;, base_url=&#39;&#39;, proxies=None):
        &#34;&#34;&#34; Initialize the FOFA client.
        &#34;&#34;&#34;
        if email == &#39;&#39;:
            email = os.environ.get(&#39;FOFA_EMAIL&#39;, &#39;&#39;)
            key = os.environ.get(&#39;FOFA_KEY&#39;, &#39;&#39;)

        if base_url == &#39;&#39;:
            base_url = os.environ.get(&#39;FOFA_BASE_URL&#39;, &#39;https://fofa.info&#39;)

        self.email = email
        self.key = key

        self.base_url = base_url.rstrip(&#39;/&#39;)

        self.lang = &#39;en&#39;
        sys_lang = get_language()
        if sys_lang != None and sys_lang.startswith(&#39;zh&#39;):
            self.lang = &#39;zh-CN&#39;

        self._session = requests.Session()
        if proxies:
            self._session.proxies.update(proxies)
            self._session.trust_env = False

        # retry config, in seconds
        self.tries = 5       # Number of retry attempts
        self.delay = 1       # Initial delay between retries
        self.max_delay = 60  # Maximum delay between retries
        self.backoff = 2     # Backoff factor for exponential backoff

    def get_userinfo(self):
        &#34;&#34;&#34;
        Get user info for current user.
    
        :return: User information in JSON format.
        :rtype: dict
        :raises FofaException: If an error occurs during the API request.
       
        :Example:
        
        The returned JSON result will be in the following format:
        
        .. code-block:: json
        
            {
                &#34;username&#34;: &#34;sample&#34;,
                &#34;fofacli_ver&#34;: &#34;4.0.3&#34;,
                &#34;fcoin&#34;: 0,
                &#34;error&#34;: false,
                &#34;fofa_server&#34;: true,
                &#34;avatar&#34;: &#34;https://nosec.org/missing.jpg&#34;,
                &#34;vip_level&#34;: 0,
                &#34;is_verified&#34;: false,
                &#34;message&#34;: &#34;&#34;,
                &#34;isvip&#34;: false,
                &#34;email&#34;: &#34;username@sample.net&#34;
            }

         &#34;&#34;&#34;
        return self.__do_req( &#34;/api/v1/info/my&#34;)

    def search(self, query_str, page=1, size=100, fields=&#34;&#34;, opts={}):
        &#34;&#34;&#34;
        Search data in FOFA.

        :param query_str: The search query string.

            Example 1:
                &#39;ip=127.0.0.1&#39;
    
            Example 2:
                &#39;header=&#34;thinkphp&#34; || header=&#34;think_template&#34;&#39;

        :type query_str: str
        :param page: Page number. Default is 1.
        :type page: int
        :param size: Number of results to be returned in one page. Default is 100.
        :type size: int
        :param fields: Comma-separated list of fields to be included in the query result.
            Example:
            &#39;ip,city&#39;
        :type fields: str
        :param opts: Additional options for the query. This should be a dictionary of key-value pairs.
        :type opts: dict
        :return: Query result in JSON format.
        :rtype: dict
        
        .. code-block:: json
        
            {
                &#34;results&#34;: [
                    [
                        &#34;111.**.241.**:8111&#34;,
                        &#34;111.**.241.**&#34;,
                        &#34;8111&#34;
                    ],
                    [
                        &#34;210.**.181.**&#34;,
                        &#34;210.**.181.**&#34;,
                        &#34;80&#34;
                    ]
                ],
                &#34;mode&#34;: &#34;extended&#34;,
                &#34;error&#34;: false,
                &#34;query&#34;: &#34;app=\\&#34;网宿科技-公司产品\\&#34;&#34;,
                &#34;page&#34;: 1,
                &#34;size&#34;: 2
            }

        &#34;&#34;&#34;
        param = opts
        param[&#39;qbase64&#39;] = encode_query(query_str)
        param[&#39;page&#39;] = page
        param[&#39;fields&#39;] = fields
        param[&#39;size&#39;] = size
        logging.debug(&#34;search &#39;%s&#39; page:%d size:%d&#34;, query_str, page, size)
        return self.__do_req(&#39;/api/v1/search/all&#39;, param)

    def can_use_next(self):
        &#34;&#34;&#34;
        Check if the &#34;search_next&#34; API can be used.

        :return: True if the &#34;search_next&#34; API can be used, False otherwise.
        :rtype: bool
        &#34;&#34;&#34;
        try:
            self.search_next(&#39;bad=query&#39;, size=1)
        except FofaError as e:
            if e.code == 820000:
                return True
            return False

    def search_next(self, query_str, fields=&#39;&#39;, size=100, next=&#39;&#39;, full=False, opts={}):
        &#34;&#34;&#34;
        Query the next page of search results.

        :param query_str: The search query string.

            Example 1:
                &#39;ip=127.0.0.1&#39;
    
            Example 2:
                &#39;header=&#34;thinkphp&#34; || header=&#34;think_template&#34;&#39;

        :param fields: The fields to be included in the response.
            Default: &#39;host,ip,port&#39;
        :type fields: str

        :param size: The number of results to be returned per page.
            Default: 100
            Maximum: 10,000
        :type size: int

        :param next: The ID for pagination.
            The next value is returned in the response of previous search query.
            If not provided, the first page of results will be returned.
        :type next: str

        :param full: Specify if all data should be searched.
            Default: False (search within the past year)
            Set to True to search all data.
        :type full: bool

        :param opts: Additional options for the search.
        :type opts: dict

        :return: The query result in JSON format.
        :rtype: dict
        &#34;&#34;&#34;
        param = opts
        param[&#39;qbase64&#39;] = encode_query(query_str)
        param[&#39;fields&#39;] = fields
        param[&#39;size&#39;] = size
        param[&#39;full&#39;] = full
        if next and next != &#39;&#39;:
            param[&#39;next&#39;] = next

        logging.debug(&#34;search next for &#39;%s&#39; size:%d, next:%s&#34;, query_str, size, next)
        return self.__do_req(&#39;/api/v1/search/next&#39;, param)

    def search_stats(self, query_str, size=5, fields=&#39;&#39;, opts={}):
        &#34;&#34;&#34;
        Query the statistics of the search results.

        :param query_str: The search query string.

            Example 1:
                &#39;ip=127.0.0.1&#39;
    
            Example 2:
                &#39;header=&#34;thinkphp&#34; || header=&#34;think_template&#34;&#39;

        :type query_str: str

        :param size: The number of results to be aggregated for each item.
            Default: 5
        :type size: int

        :param fields: The fields to be included in the aggregation.
            Example: &#39;ip,city&#39;
        :type fields: str

        :param opts: Additional options for the search.
        :type opts: dict

        :return: query result in json format


        .. code-block:: json

            {
                &#34;distinct&#34;: {
                    &#34;ip&#34;: 1717,
                    &#34;title&#34;: 411
                },
                &#34;lastupdatetime&#34;: &#34;2022-06-17 13:00:00&#34;,
                &#34;aggs&#34;: {
                    &#34;title&#34;: [
                        {
                            &#34;count&#34;: 35,
                            &#34;name&#34;: &#34;百度一下，你就知道&#34;
                        },
                        {
                            &#34;count&#34;: 25,
                            &#34;name&#34;: &#34;百度网盘-免费云盘丨文件共享软件丨超大容量丨存储安全&#34;
                        },
                        {
                            &#34;count&#34;: 16,
                            &#34;name&#34;: &#34;百度智能云-登录&#34;
                        },
                        {
                            &#34;count&#34;: 2,
                            &#34;name&#34;: &#34;百度翻译开放平台&#34;
                        }
                    ],
                    &#34;countries&#34;: []
                },
                &#34;error&#34;: false
            }

        &#34;&#34;&#34;
        param = opts
        param[&#39;qbase64&#39;] = encode_query(query_str)
        param[&#39;fields&#39;] = fields
        param[&#39;size&#39;] = size
        return self.__do_req(&#39;/api/v1/search/stats&#39;, param)

    def search_host(self, host, detail=False, opts={}):
        &#34;&#34;&#34;
        Search for host information based on the specified IP address or domain.

        :param host: The IP address or domain of the host to search for.
        :type host: str
        :param detail: Optional. Specifies whether to show detailed information. Default is False.
        :type detail: bool
        :param opts: Optional. Additional options for the search. Default is an empty dictionary.
        :type opts: dict
        :return: The query result in JSON format.
        :rtype: dict

        .. code-block:: json

           {
                &#34;error&#34;: false,
                &#34;host&#34;: &#34;78.48.50.249&#34;,
                &#34;ip&#34;: &#34;78.48.50.249&#34;,
                &#34;asn&#34;: 6805,
                &#34;org&#34;: &#34;Telefonica Germany&#34;,
                &#34;country_name&#34;: &#34;Germany&#34;,
                &#34;country_code&#34;: &#34;DE&#34;,
                &#34;protocol&#34;: [
                    &#34;http&#34;,
                    &#34;https&#34;
                ],
                &#34;port&#34;: [
                    80,
                    443
                ],
                &#34;category&#34;: [
                    &#34;CMS&#34;
                ],
                &#34;product&#34;: [
                    &#34;Synology-WebStation&#34;
                ],
                &#34;update_time&#34;: &#34;2022-06-11 08:00:00&#34;
            }

        &#34;&#34;&#34;
        param = opts
        param[&#39;detail&#39;] = detail

        u = &#39;/api/v1/host/%s&#39; % host
        return self.__do_req(u, param)

    def __do_req(self, path, params=None, method=&#39;get&#39;):
        u = self.base_url + path
        data = None
        req_param = {}

        if not self.email or self.email == &#39;&#39;:
            raise FofaError(&#34;Empty fofa email&#34;)

        if not self.key or self.key == &#39;&#39;:
            raise FofaError(&#34;Empty fofa api key&#34;)

        if params == None:
            req_param = {
                &#34;email&#34;: self.email,
                &#34;key&#34;: self.key,
                &#34;lang&#34;: self.lang,
            }
        else:
            req_param = params
            req_param[&#39;email&#39;] = self.email
            req_param[&#39;key&#39;] = self.key
            req_param[&#39;lang&#39;] = self.lang

        if method == &#39;post&#39;:
            data = params
            params = None

        def make_request():
            headers = {&#34;Accept-Encoding&#34;: &#34;gzip&#34;}
            response = self._session.request(url=u, method=method, data=data, params=req_param, headers=headers)
            if response.status_code != 200:
                raise Exception(&#34;Request failed with status code: {}&#34;.format(response.status_code))
            return response
        res = retry_call(make_request,
                         tries = self.tries,
                         delay = self.delay,
                         max_delay = self.max_delay,
                         backoff=self.backoff)
        data = res.json()
        if &#39;error&#39; in data and data[&#39;error&#39;]:
            raise FofaError(data[&#39;errmsg&#39;])
        return data

if __name__ == &#34;__main__&#34;:
    client = Client()
    logging.basicConfig(level=logging.DEBUG)
    print(client.can_use_next())
    print(json.dumps(client.get_userinfo(), ensure_ascii=False))
    print(json.dumps(client.search(&#39;app=&#34;网宿科技-公司产品&#34;&#39;, page=1), ensure_ascii=False))
    print(json.dumps(client.search_host(&#39;78.48.50.249&#39;, detail=True), ensure_ascii=False))
    print(json.dumps(client.search_stats(&#39;domain=&#34;baidu.com&#34;&#39;, fields=&#39;title&#39;), ensure_ascii=False))</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="fofa.client.Client"><code class="flex name class">
<span>class <span class="ident">Client</span></span>
<span>(</span><span>email='', key='', base_url='', proxies=None)</span>
</code></dt>
<dd>
<div class="desc"><p>A class representing the FOFA client.</p>
<p>:param email: The Fofa Email. If not specified, it will be read from the FOFA_EMAIL environment variable.
:type email: str
:param key: The Fofa api key. If not specified, it will be read from the FOFA_KEY environment variable.
:type key: str
:param base_url: The base URL of the FOFA API. Defaults to 'https://fofa.info'.
:type base_url: str
:param proxies:
A proxies array for the requests library, e.g. {'https': 'your proxy'}
:type proxies: dict</p>
<p>Initialize the FOFA client.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class Client:
    &#34;&#34;&#34;
    A class representing the FOFA client.

    :param email: The Fofa Email. If not specified, it will be read from the FOFA_EMAIL environment variable.
    :type email: str
    :param key: The Fofa api key. If not specified, it will be read from the FOFA_KEY environment variable.
    :type key: str
    :param base_url: The base URL of the FOFA API. Defaults to &#39;https://fofa.info&#39;.
    :type base_url: str
    :param proxies:  A proxies array for the requests library, e.g. {&#39;https&#39;: &#39;your proxy&#39;}
    :type proxies: dict

    &#34;&#34;&#34;

    def __init__(self, email=&#39;&#39;, key=&#39;&#39;, base_url=&#39;&#39;, proxies=None):
        &#34;&#34;&#34; Initialize the FOFA client.
        &#34;&#34;&#34;
        if email == &#39;&#39;:
            email = os.environ.get(&#39;FOFA_EMAIL&#39;, &#39;&#39;)
            key = os.environ.get(&#39;FOFA_KEY&#39;, &#39;&#39;)

        if base_url == &#39;&#39;:
            base_url = os.environ.get(&#39;FOFA_BASE_URL&#39;, &#39;https://fofa.info&#39;)

        self.email = email
        self.key = key

        self.base_url = base_url.rstrip(&#39;/&#39;)

        self.lang = &#39;en&#39;
        sys_lang = get_language()
        if sys_lang != None and sys_lang.startswith(&#39;zh&#39;):
            self.lang = &#39;zh-CN&#39;

        self._session = requests.Session()
        if proxies:
            self._session.proxies.update(proxies)
            self._session.trust_env = False

        # retry config, in seconds
        self.tries = 5       # Number of retry attempts
        self.delay = 1       # Initial delay between retries
        self.max_delay = 60  # Maximum delay between retries
        self.backoff = 2     # Backoff factor for exponential backoff

    def get_userinfo(self):
        &#34;&#34;&#34;
        Get user info for current user.
    
        :return: User information in JSON format.
        :rtype: dict
        :raises FofaException: If an error occurs during the API request.
       
        :Example:
        
        The returned JSON result will be in the following format:
        
        .. code-block:: json
        
            {
                &#34;username&#34;: &#34;sample&#34;,
                &#34;fofacli_ver&#34;: &#34;4.0.3&#34;,
                &#34;fcoin&#34;: 0,
                &#34;error&#34;: false,
                &#34;fofa_server&#34;: true,
                &#34;avatar&#34;: &#34;https://nosec.org/missing.jpg&#34;,
                &#34;vip_level&#34;: 0,
                &#34;is_verified&#34;: false,
                &#34;message&#34;: &#34;&#34;,
                &#34;isvip&#34;: false,
                &#34;email&#34;: &#34;username@sample.net&#34;
            }

         &#34;&#34;&#34;
        return self.__do_req( &#34;/api/v1/info/my&#34;)

    def search(self, query_str, page=1, size=100, fields=&#34;&#34;, opts={}):
        &#34;&#34;&#34;
        Search data in FOFA.

        :param query_str: The search query string.

            Example 1:
                &#39;ip=127.0.0.1&#39;
    
            Example 2:
                &#39;header=&#34;thinkphp&#34; || header=&#34;think_template&#34;&#39;

        :type query_str: str
        :param page: Page number. Default is 1.
        :type page: int
        :param size: Number of results to be returned in one page. Default is 100.
        :type size: int
        :param fields: Comma-separated list of fields to be included in the query result.
            Example:
            &#39;ip,city&#39;
        :type fields: str
        :param opts: Additional options for the query. This should be a dictionary of key-value pairs.
        :type opts: dict
        :return: Query result in JSON format.
        :rtype: dict
        
        .. code-block:: json
        
            {
                &#34;results&#34;: [
                    [
                        &#34;111.**.241.**:8111&#34;,
                        &#34;111.**.241.**&#34;,
                        &#34;8111&#34;
                    ],
                    [
                        &#34;210.**.181.**&#34;,
                        &#34;210.**.181.**&#34;,
                        &#34;80&#34;
                    ]
                ],
                &#34;mode&#34;: &#34;extended&#34;,
                &#34;error&#34;: false,
                &#34;query&#34;: &#34;app=\\&#34;网宿科技-公司产品\\&#34;&#34;,
                &#34;page&#34;: 1,
                &#34;size&#34;: 2
            }

        &#34;&#34;&#34;
        param = opts
        param[&#39;qbase64&#39;] = encode_query(query_str)
        param[&#39;page&#39;] = page
        param[&#39;fields&#39;] = fields
        param[&#39;size&#39;] = size
        logging.debug(&#34;search &#39;%s&#39; page:%d size:%d&#34;, query_str, page, size)
        return self.__do_req(&#39;/api/v1/search/all&#39;, param)

    def can_use_next(self):
        &#34;&#34;&#34;
        Check if the &#34;search_next&#34; API can be used.

        :return: True if the &#34;search_next&#34; API can be used, False otherwise.
        :rtype: bool
        &#34;&#34;&#34;
        try:
            self.search_next(&#39;bad=query&#39;, size=1)
        except FofaError as e:
            if e.code == 820000:
                return True
            return False

    def search_next(self, query_str, fields=&#39;&#39;, size=100, next=&#39;&#39;, full=False, opts={}):
        &#34;&#34;&#34;
        Query the next page of search results.

        :param query_str: The search query string.

            Example 1:
                &#39;ip=127.0.0.1&#39;
    
            Example 2:
                &#39;header=&#34;thinkphp&#34; || header=&#34;think_template&#34;&#39;

        :param fields: The fields to be included in the response.
            Default: &#39;host,ip,port&#39;
        :type fields: str

        :param size: The number of results to be returned per page.
            Default: 100
            Maximum: 10,000
        :type size: int

        :param next: The ID for pagination.
            The next value is returned in the response of previous search query.
            If not provided, the first page of results will be returned.
        :type next: str

        :param full: Specify if all data should be searched.
            Default: False (search within the past year)
            Set to True to search all data.
        :type full: bool

        :param opts: Additional options for the search.
        :type opts: dict

        :return: The query result in JSON format.
        :rtype: dict
        &#34;&#34;&#34;
        param = opts
        param[&#39;qbase64&#39;] = encode_query(query_str)
        param[&#39;fields&#39;] = fields
        param[&#39;size&#39;] = size
        param[&#39;full&#39;] = full
        if next and next != &#39;&#39;:
            param[&#39;next&#39;] = next

        logging.debug(&#34;search next for &#39;%s&#39; size:%d, next:%s&#34;, query_str, size, next)
        return self.__do_req(&#39;/api/v1/search/next&#39;, param)

    def search_stats(self, query_str, size=5, fields=&#39;&#39;, opts={}):
        &#34;&#34;&#34;
        Query the statistics of the search results.

        :param query_str: The search query string.

            Example 1:
                &#39;ip=127.0.0.1&#39;
    
            Example 2:
                &#39;header=&#34;thinkphp&#34; || header=&#34;think_template&#34;&#39;

        :type query_str: str

        :param size: The number of results to be aggregated for each item.
            Default: 5
        :type size: int

        :param fields: The fields to be included in the aggregation.
            Example: &#39;ip,city&#39;
        :type fields: str

        :param opts: Additional options for the search.
        :type opts: dict

        :return: query result in json format


        .. code-block:: json

            {
                &#34;distinct&#34;: {
                    &#34;ip&#34;: 1717,
                    &#34;title&#34;: 411
                },
                &#34;lastupdatetime&#34;: &#34;2022-06-17 13:00:00&#34;,
                &#34;aggs&#34;: {
                    &#34;title&#34;: [
                        {
                            &#34;count&#34;: 35,
                            &#34;name&#34;: &#34;百度一下，你就知道&#34;
                        },
                        {
                            &#34;count&#34;: 25,
                            &#34;name&#34;: &#34;百度网盘-免费云盘丨文件共享软件丨超大容量丨存储安全&#34;
                        },
                        {
                            &#34;count&#34;: 16,
                            &#34;name&#34;: &#34;百度智能云-登录&#34;
                        },
                        {
                            &#34;count&#34;: 2,
                            &#34;name&#34;: &#34;百度翻译开放平台&#34;
                        }
                    ],
                    &#34;countries&#34;: []
                },
                &#34;error&#34;: false
            }

        &#34;&#34;&#34;
        param = opts
        param[&#39;qbase64&#39;] = encode_query(query_str)
        param[&#39;fields&#39;] = fields
        param[&#39;size&#39;] = size
        return self.__do_req(&#39;/api/v1/search/stats&#39;, param)

    def search_host(self, host, detail=False, opts={}):
        &#34;&#34;&#34;
        Search for host information based on the specified IP address or domain.

        :param host: The IP address or domain of the host to search for.
        :type host: str
        :param detail: Optional. Specifies whether to show detailed information. Default is False.
        :type detail: bool
        :param opts: Optional. Additional options for the search. Default is an empty dictionary.
        :type opts: dict
        :return: The query result in JSON format.
        :rtype: dict

        .. code-block:: json

           {
                &#34;error&#34;: false,
                &#34;host&#34;: &#34;78.48.50.249&#34;,
                &#34;ip&#34;: &#34;78.48.50.249&#34;,
                &#34;asn&#34;: 6805,
                &#34;org&#34;: &#34;Telefonica Germany&#34;,
                &#34;country_name&#34;: &#34;Germany&#34;,
                &#34;country_code&#34;: &#34;DE&#34;,
                &#34;protocol&#34;: [
                    &#34;http&#34;,
                    &#34;https&#34;
                ],
                &#34;port&#34;: [
                    80,
                    443
                ],
                &#34;category&#34;: [
                    &#34;CMS&#34;
                ],
                &#34;product&#34;: [
                    &#34;Synology-WebStation&#34;
                ],
                &#34;update_time&#34;: &#34;2022-06-11 08:00:00&#34;
            }

        &#34;&#34;&#34;
        param = opts
        param[&#39;detail&#39;] = detail

        u = &#39;/api/v1/host/%s&#39; % host
        return self.__do_req(u, param)

    def __do_req(self, path, params=None, method=&#39;get&#39;):
        u = self.base_url + path
        data = None
        req_param = {}

        if not self.email or self.email == &#39;&#39;:
            raise FofaError(&#34;Empty fofa email&#34;)

        if not self.key or self.key == &#39;&#39;:
            raise FofaError(&#34;Empty fofa api key&#34;)

        if params == None:
            req_param = {
                &#34;email&#34;: self.email,
                &#34;key&#34;: self.key,
                &#34;lang&#34;: self.lang,
            }
        else:
            req_param = params
            req_param[&#39;email&#39;] = self.email
            req_param[&#39;key&#39;] = self.key
            req_param[&#39;lang&#39;] = self.lang

        if method == &#39;post&#39;:
            data = params
            params = None

        def make_request():
            headers = {&#34;Accept-Encoding&#34;: &#34;gzip&#34;}
            response = self._session.request(url=u, method=method, data=data, params=req_param, headers=headers)
            if response.status_code != 200:
                raise Exception(&#34;Request failed with status code: {}&#34;.format(response.status_code))
            return response
        res = retry_call(make_request,
                         tries = self.tries,
                         delay = self.delay,
                         max_delay = self.max_delay,
                         backoff=self.backoff)
        data = res.json()
        if &#39;error&#39; in data and data[&#39;error&#39;]:
            raise FofaError(data[&#39;errmsg&#39;])
        return data</code></pre>
</details>
<h3>Methods</h3>
<dl>
<dt id="fofa.client.Client.can_use_next"><code class="name flex">
<span>def <span class="ident">can_use_next</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Check if the "search_next" API can be used.</p>
<p>:return: True if the "search_next" API can be used, False otherwise.
:rtype: bool</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def can_use_next(self):
    &#34;&#34;&#34;
    Check if the &#34;search_next&#34; API can be used.

    :return: True if the &#34;search_next&#34; API can be used, False otherwise.
    :rtype: bool
    &#34;&#34;&#34;
    try:
        self.search_next(&#39;bad=query&#39;, size=1)
    except FofaError as e:
        if e.code == 820000:
            return True
        return False</code></pre>
</details>
</dd>
<dt id="fofa.client.Client.get_userinfo"><code class="name flex">
<span>def <span class="ident">get_userinfo</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Get user info for current user.</p>
<p>:return: User information in JSON format.
:rtype: dict
:raises FofaException: If an error occurs during the API request.</p>
<p>:Example:</p>
<p>The returned JSON result will be in the following format:</p>
<p>.. code-block:: json</p>
<pre><code>{
    "username": "sample",
    "fofacli_ver": "4.0.3",
    "fcoin": 0,
    "error": false,
    "fofa_server": true,
    "avatar": "https://nosec.org/missing.jpg",
    "vip_level": 0,
    "is_verified": false,
    "message": "",
    "isvip": false,
    "email": "username@sample.net"
}
</code></pre></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_userinfo(self):
    &#34;&#34;&#34;
    Get user info for current user.

    :return: User information in JSON format.
    :rtype: dict
    :raises FofaException: If an error occurs during the API request.
   
    :Example:
    
    The returned JSON result will be in the following format:
    
    .. code-block:: json
    
        {
            &#34;username&#34;: &#34;sample&#34;,
            &#34;fofacli_ver&#34;: &#34;4.0.3&#34;,
            &#34;fcoin&#34;: 0,
            &#34;error&#34;: false,
            &#34;fofa_server&#34;: true,
            &#34;avatar&#34;: &#34;https://nosec.org/missing.jpg&#34;,
            &#34;vip_level&#34;: 0,
            &#34;is_verified&#34;: false,
            &#34;message&#34;: &#34;&#34;,
            &#34;isvip&#34;: false,
            &#34;email&#34;: &#34;username@sample.net&#34;
        }

     &#34;&#34;&#34;
    return self.__do_req( &#34;/api/v1/info/my&#34;)</code></pre>
</details>
</dd>
<dt id="fofa.client.Client.search"><code class="name flex">
<span>def <span class="ident">search</span></span>(<span>self, query_str, page=1, size=100, fields='', opts={})</span>
</code></dt>
<dd>
<div class="desc"><p>Search data in FOFA.</p>
<p>:param query_str: The search query string.</p>
<pre><code>Example 1:
    'ip=127.0.0.1'

Example 2:
    'header="thinkphp" || header="think_template"'
</code></pre>
<p>:type query_str: str
:param page: Page number. Default is 1.
:type page: int
:param size: Number of results to be returned in one page. Default is 100.
:type size: int
:param fields: Comma-separated list of fields to be included in the query result.
Example:
'ip,city'
:type fields: str
:param opts: Additional options for the query. This should be a dictionary of key-value pairs.
:type opts: dict
:return: Query result in JSON format.
:rtype: dict</p>
<p>.. code-block:: json</p>
<pre><code>{
    "results": [
        [
            "111.**.241.**:8111",
            "111.**.241.**",
            "8111"
        ],
        [
            "210.**.181.**",
            "210.**.181.**",
            "80"
        ]
    ],
    "mode": "extended",
    "error": false,
    "query": "app=\"网宿科技-公司产品\"",
    "page": 1,
    "size": 2
}
</code></pre></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def search(self, query_str, page=1, size=100, fields=&#34;&#34;, opts={}):
    &#34;&#34;&#34;
    Search data in FOFA.

    :param query_str: The search query string.

        Example 1:
            &#39;ip=127.0.0.1&#39;

        Example 2:
            &#39;header=&#34;thinkphp&#34; || header=&#34;think_template&#34;&#39;

    :type query_str: str
    :param page: Page number. Default is 1.
    :type page: int
    :param size: Number of results to be returned in one page. Default is 100.
    :type size: int
    :param fields: Comma-separated list of fields to be included in the query result.
        Example:
        &#39;ip,city&#39;
    :type fields: str
    :param opts: Additional options for the query. This should be a dictionary of key-value pairs.
    :type opts: dict
    :return: Query result in JSON format.
    :rtype: dict
    
    .. code-block:: json
    
        {
            &#34;results&#34;: [
                [
                    &#34;111.**.241.**:8111&#34;,
                    &#34;111.**.241.**&#34;,
                    &#34;8111&#34;
                ],
                [
                    &#34;210.**.181.**&#34;,
                    &#34;210.**.181.**&#34;,
                    &#34;80&#34;
                ]
            ],
            &#34;mode&#34;: &#34;extended&#34;,
            &#34;error&#34;: false,
            &#34;query&#34;: &#34;app=\\&#34;网宿科技-公司产品\\&#34;&#34;,
            &#34;page&#34;: 1,
            &#34;size&#34;: 2
        }

    &#34;&#34;&#34;
    param = opts
    param[&#39;qbase64&#39;] = encode_query(query_str)
    param[&#39;page&#39;] = page
    param[&#39;fields&#39;] = fields
    param[&#39;size&#39;] = size
    logging.debug(&#34;search &#39;%s&#39; page:%d size:%d&#34;, query_str, page, size)
    return self.__do_req(&#39;/api/v1/search/all&#39;, param)</code></pre>
</details>
</dd>
<dt id="fofa.client.Client.search_host"><code class="name flex">
<span>def <span class="ident">search_host</span></span>(<span>self, host, detail=False, opts={})</span>
</code></dt>
<dd>
<div class="desc"><p>Search for host information based on the specified IP address or domain.</p>
<p>:param host: The IP address or domain of the host to search for.
:type host: str
:param detail: Optional. Specifies whether to show detailed information. Default is False.
:type detail: bool
:param opts: Optional. Additional options for the search. Default is an empty dictionary.
:type opts: dict
:return: The query result in JSON format.
:rtype: dict</p>
<p>.. code-block:: json</p>
<p>{
"error": false,
"host": "78.48.50.249",
"ip": "78.48.50.249",
"asn": 6805,
"org": "Telefonica Germany",
"country_name": "Germany",
"country_code": "DE",
"protocol": [
"http",
"https"
],
"port": [
80,
443
],
"category": [
"CMS"
],
"product": [
"Synology-WebStation"
],
"update_time": "2022-06-11 08:00:00"
}</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def search_host(self, host, detail=False, opts={}):
    &#34;&#34;&#34;
    Search for host information based on the specified IP address or domain.

    :param host: The IP address or domain of the host to search for.
    :type host: str
    :param detail: Optional. Specifies whether to show detailed information. Default is False.
    :type detail: bool
    :param opts: Optional. Additional options for the search. Default is an empty dictionary.
    :type opts: dict
    :return: The query result in JSON format.
    :rtype: dict

    .. code-block:: json

       {
            &#34;error&#34;: false,
            &#34;host&#34;: &#34;78.48.50.249&#34;,
            &#34;ip&#34;: &#34;78.48.50.249&#34;,
            &#34;asn&#34;: 6805,
            &#34;org&#34;: &#34;Telefonica Germany&#34;,
            &#34;country_name&#34;: &#34;Germany&#34;,
            &#34;country_code&#34;: &#34;DE&#34;,
            &#34;protocol&#34;: [
                &#34;http&#34;,
                &#34;https&#34;
            ],
            &#34;port&#34;: [
                80,
                443
            ],
            &#34;category&#34;: [
                &#34;CMS&#34;
            ],
            &#34;product&#34;: [
                &#34;Synology-WebStation&#34;
            ],
            &#34;update_time&#34;: &#34;2022-06-11 08:00:00&#34;
        }

    &#34;&#34;&#34;
    param = opts
    param[&#39;detail&#39;] = detail

    u = &#39;/api/v1/host/%s&#39; % host
    return self.__do_req(u, param)</code></pre>
</details>
</dd>
<dt id="fofa.client.Client.search_next"><code class="name flex">
<span>def <span class="ident">search_next</span></span>(<span>self, query_str, fields='', size=100, next='', full=False, opts={})</span>
</code></dt>
<dd>
<div class="desc"><p>Query the next page of search results.</p>
<p>:param query_str: The search query string.</p>
<pre><code>Example 1:
    'ip=127.0.0.1'

Example 2:
    'header="thinkphp" || header="think_template"'
</code></pre>
<p>:param fields: The fields to be included in the response.
Default: 'host,ip,port'
:type fields: str</p>
<p>:param size: The number of results to be returned per page.
Default: 100
Maximum: 10,000
:type size: int</p>
<p>:param next: The ID for pagination.
The next value is returned in the response of previous search query.
If not provided, the first page of results will be returned.
:type next: str</p>
<p>:param full: Specify if all data should be searched.
Default: False (search within the past year)
Set to True to search all data.
:type full: bool</p>
<p>:param opts: Additional options for the search.
:type opts: dict</p>
<p>:return: The query result in JSON format.
:rtype: dict</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def search_next(self, query_str, fields=&#39;&#39;, size=100, next=&#39;&#39;, full=False, opts={}):
    &#34;&#34;&#34;
    Query the next page of search results.

    :param query_str: The search query string.

        Example 1:
            &#39;ip=127.0.0.1&#39;

        Example 2:
            &#39;header=&#34;thinkphp&#34; || header=&#34;think_template&#34;&#39;

    :param fields: The fields to be included in the response.
        Default: &#39;host,ip,port&#39;
    :type fields: str

    :param size: The number of results to be returned per page.
        Default: 100
        Maximum: 10,000
    :type size: int

    :param next: The ID for pagination.
        The next value is returned in the response of previous search query.
        If not provided, the first page of results will be returned.
    :type next: str

    :param full: Specify if all data should be searched.
        Default: False (search within the past year)
        Set to True to search all data.
    :type full: bool

    :param opts: Additional options for the search.
    :type opts: dict

    :return: The query result in JSON format.
    :rtype: dict
    &#34;&#34;&#34;
    param = opts
    param[&#39;qbase64&#39;] = encode_query(query_str)
    param[&#39;fields&#39;] = fields
    param[&#39;size&#39;] = size
    param[&#39;full&#39;] = full
    if next and next != &#39;&#39;:
        param[&#39;next&#39;] = next

    logging.debug(&#34;search next for &#39;%s&#39; size:%d, next:%s&#34;, query_str, size, next)
    return self.__do_req(&#39;/api/v1/search/next&#39;, param)</code></pre>
</details>
</dd>
<dt id="fofa.client.Client.search_stats"><code class="name flex">
<span>def <span class="ident">search_stats</span></span>(<span>self, query_str, size=5, fields='', opts={})</span>
</code></dt>
<dd>
<div class="desc"><p>Query the statistics of the search results.</p>
<p>:param query_str: The search query string.</p>
<pre><code>Example 1:
    'ip=127.0.0.1'

Example 2:
    'header="thinkphp" || header="think_template"'
</code></pre>
<p>:type query_str: str</p>
<p>:param size: The number of results to be aggregated for each item.
Default: 5
:type size: int</p>
<p>:param fields: The fields to be included in the aggregation.
Example: 'ip,city'
:type fields: str</p>
<p>:param opts: Additional options for the search.
:type opts: dict</p>
<p>:return: query result in json format</p>
<p>.. code-block:: json</p>
<pre><code>{
    "distinct": {
        "ip": 1717,
        "title": 411
    },
    "lastupdatetime": "2022-06-17 13:00:00",
    "aggs": {
        "title": [
            {
                "count": 35,
                "name": "百度一下，你就知道"
            },
            {
                "count": 25,
                "name": "百度网盘-免费云盘丨文件共享软件丨超大容量丨存储安全"
            },
            {
                "count": 16,
                "name": "百度智能云-登录"
            },
            {
                "count": 2,
                "name": "百度翻译开放平台"
            }
        ],
        "countries": []
    },
    "error": false
}
</code></pre></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def search_stats(self, query_str, size=5, fields=&#39;&#39;, opts={}):
    &#34;&#34;&#34;
    Query the statistics of the search results.

    :param query_str: The search query string.

        Example 1:
            &#39;ip=127.0.0.1&#39;

        Example 2:
            &#39;header=&#34;thinkphp&#34; || header=&#34;think_template&#34;&#39;

    :type query_str: str

    :param size: The number of results to be aggregated for each item.
        Default: 5
    :type size: int

    :param fields: The fields to be included in the aggregation.
        Example: &#39;ip,city&#39;
    :type fields: str

    :param opts: Additional options for the search.
    :type opts: dict

    :return: query result in json format


    .. code-block:: json

        {
            &#34;distinct&#34;: {
                &#34;ip&#34;: 1717,
                &#34;title&#34;: 411
            },
            &#34;lastupdatetime&#34;: &#34;2022-06-17 13:00:00&#34;,
            &#34;aggs&#34;: {
                &#34;title&#34;: [
                    {
                        &#34;count&#34;: 35,
                        &#34;name&#34;: &#34;百度一下，你就知道&#34;
                    },
                    {
                        &#34;count&#34;: 25,
                        &#34;name&#34;: &#34;百度网盘-免费云盘丨文件共享软件丨超大容量丨存储安全&#34;
                    },
                    {
                        &#34;count&#34;: 16,
                        &#34;name&#34;: &#34;百度智能云-登录&#34;
                    },
                    {
                        &#34;count&#34;: 2,
                        &#34;name&#34;: &#34;百度翻译开放平台&#34;
                    }
                ],
                &#34;countries&#34;: []
            },
            &#34;error&#34;: false
        }

    &#34;&#34;&#34;
    param = opts
    param[&#39;qbase64&#39;] = encode_query(query_str)
    param[&#39;fields&#39;] = fields
    param[&#39;size&#39;] = size
    return self.__do_req(&#39;/api/v1/search/stats&#39;, param)</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="fofa" href="index.html">fofa</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="fofa.client.Client" href="#fofa.client.Client">Client</a></code></h4>
<ul class="two-column">
<li><code><a title="fofa.client.Client.can_use_next" href="#fofa.client.Client.can_use_next">can_use_next</a></code></li>
<li><code><a title="fofa.client.Client.get_userinfo" href="#fofa.client.Client.get_userinfo">get_userinfo</a></code></li>
<li><code><a title="fofa.client.Client.search" href="#fofa.client.Client.search">search</a></code></li>
<li><code><a title="fofa.client.Client.search_host" href="#fofa.client.Client.search_host">search_host</a></code></li>
<li><code><a title="fofa.client.Client.search_next" href="#fofa.client.Client.search_next">search_next</a></code></li>
<li><code><a title="fofa.client.Client.search_stats" href="#fofa.client.Client.search_stats">search_stats</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>